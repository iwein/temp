<!DOCTYPE html>
<html>
<head>
    <script src="//cdn.optimizely.com/js/2211330333.js"></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="web application">
    <meta name="author" content="HackandCraft">
    <title>Scotty</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    <link type="text/css" rel="stylesheet" href="http://fast.fonts.net/cssapi/ad86cd99-af73-48f3-b26d-bec8dd63fa59.css"/>
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,900' rel='stylesheet' type='text/css'>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- build:css build.css -->
    <link rel="stylesheet/less" href="index/styles.less">
    <script>less = { logLevel: 1 };</script>
    <script src="../bower_components/less/dist/less-1.7.0.js"></script>
    <!-- endbuild -->
</head>
<body class="static-page">
<div class="page-wrap">
    <div id="header-container"></div>

    <div class="alert-container">
        <div id="error" class="alert alert-danger not-visible">
            Unknown email or password.
        </div>
    </div>

    <div id="content">
        <div class="banner">
            <div class="banner-inner banner-inner-small">
                <div class="banner-login">
                    <h3>Enter as candidate or employer</h3>
                    <form id="login-form">

                        <div class="form-group required row">
                            <label class="col-sm-4">Email</label>
                            <div class="col-sm-8">
                                <input class="form-control" type="email" name="email" required>
                            </div>
                        </div>
                        <div class="form-group required row">
                            <label class="col-sm-4">Password</label>
                            <div class="col-sm-8">
                                <input class="form-control" type="password" name="password" required>
                            </div>
                        </div>
                        <div class="buttons-wrap">
                            <button type="submit" class="fl-rg bg-green btn-small mrg-lft-small">Login</button>
                            <a class="forget" href="forgot-password.html">Forgot your password?</a>
                            <div class="clearfix"></div>
                        </div>
                        <div class="signup-link">Donâ€˜t have a login yet, sign up <a href="candidate/#/signup" class="orange">here</a>.</div>
                        <div class="clearfix"></div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="footer-container"></div>

<!-- build:js build.js -->
<script src="../bower_components/requirejs/require.js"></script>
<script src="index/requirejs-config.js"></script>
<!-- endbuild -->

<script type="text/javascript">
    require([ 'apps/index/app' ], function(app) {
        'use strict';
        var url = app.config.api_url + 'v1/login';
        var $form = document.getElementById('login-form');
        var $email = document.getElementsByName('email')[0];
        var $password = document.getElementsByName('password')[0];
        var $error = document.getElementById('error');


        $form.addEventListener('submit', function(event) {
            event.preventDefault();
            request(url, {
                email: $email.value,
                pwd: $password.value,
            }, function(response) {
                if (response.status === 404)
                    return showError();

                var data = JSON.parse(response.responseText);
                document.location = data.preferred;
            });
        }, true);


        function showError() {
            show($error);
            setTimeout(hide.bind(null, $error), 5000);
        }

        function show(element) {
            element.style.display = 'block';
        }

        function hide(element) {
            element.style.display = 'none';
        }

        function request(url, data, callback) {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', url);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.withCredentials = true;
            xhr.send(JSON.stringify(data));
            xhr.addEventListener('readystatechange', function() {
                if (xhr.readyState === 4)
                    callback(xhr);
            });
        }
    });
</script>
</body>
</html>
